<div class="container">
  <div class="row">
    <button label="Add new user" (click)="showDialogToAdd()" style="margin-bottom: 10px;" icon="fa-plus" type="button" pButton></button>

    <p-dataTable
        [value]="users"
        sortMode="multiple"
        resizableColumns="true" columnResizeMode="expand"
        [rows]="10" [paginator]="true" [pageLinks]="5"
        expandableRows="true"
    >

      <header>Total users: {{users?.length}}</header>

      <p-column [style]="{'width':'40px'}" expander="true" styleClass="col-icon"></p-column>
      <p-column [style]="{'width':'55px'}" field="id" header="id" [sortable]="true"></p-column>
      <p-column [style]="{'width':'120px'}" field="username" header="username" [sortable]="true"></p-column>
      <p-column [style]="{'width':'130px'}" field="email" header="email" [sortable]="true"></p-column>
      <p-column [style]="{'width':'100px'}" field="enabled" header="enabled" [sortable]="true"></p-column>
      <p-column [style]="{'width':'170px'}" field="lastLogin" header="lastLogin" [sortable]="true">
        <template let-col let-user="rowData" pTemplate="body">
          <span>{{ user[col.field] | date:"y-MM-dd H:m:s" }}</span>
        </template>
      </p-column>
      <p-column field="roles" header="roles"></p-column>

      <!-- edit buttons -->
      <p-column [style]="{'width':'95px'}" styleClass="col-button">
        <template pTemplate="header"></template>
        <template let-user="rowData" pTemplate="body">
          <button (click)="editUser(user.id)" icon="fa-pencil-square-o" type="button" pButton></button>
          <button (click)="deleteUser(user.id)" icon="fa-close" class="ui-button-danger" type="button" pButton></button>
        </template>
      </p-column>

      <!-- expanded row -->
      <template let-user pTemplate="rowexpansion">
        <div class="ui-grid ui-grid-responsive ui-fluid">
          <div class="ui-grid-row">
            <div class="ui-grid-col-1" style="text-align:center">
              <!--<i class="fa fa-search" style="cursor:pointer;float:left;margin-top:40px"></i>-->
            </div>
            <div class="ui-grid-col-11">
              <div class="ui-grid ui-grid-responsive ui-grid-pad">
                <div class="ui-grid-row">
                  <div class="ui-grid-col-2 label">createdBy:</div>
                  <div class="ui-grid-col-10">{{user.createdBy?.username}}</div>
                </div>
                <div class="ui-grid-row">
                  <div class="ui-grid-col-2 label">modifiedBy:</div>
                  <div class="ui-grid-col-10">{{user.modifiedBy?.username}}</div>
                </div>
                <div class="ui-grid-row">
                  <div class="ui-grid-col-2 label">createdAt:</div>
                  <div class="ui-grid-col-10">{{user.createdAt | date:"y-MM-dd H:m:s"}}</div>
                </div>
                <div class="ui-grid-row">
                  <div class="ui-grid-col-2 label">modifiedAt:</div>
                  <div class="ui-grid-col-10">{{user.modifiedAt | date:"y-MM-dd H:m:s"}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>
    </p-dataTable>

    <p-dialog
        header="{{ isNewUser?'Add user':'Edit user' }}"
        [(visible)]="isDialogVisible"
        [responsive]="true" showEffect="fade" [modal]="true"
    >
      <form name="userform" (ngSubmit)="f.form.valid" #f="ngForm" novalidate>
        <div *ngIf="currentUser" class="ui-grid ui-grid-responsive ui-fluid">
          <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label>Username*</label></div>
            <div class="ui-grid-col-8">
              <input [(ngModel)]="currentUser.username" name="username" pInputText required/>
            </div>
          </div>
          <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label>Password*</label></div>
            <div class="ui-grid-col-8">
              <input [(ngModel)]="currentUser.password" name="password" pInputText required/>
            </div>
          </div>
          <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label>Email*</label></div>
            <div class="ui-grid-col-8">
              <input [(ngModel)]="currentUser.email" name="email" pInputText required/>
            </div>
          </div>
          <div class="ui-grid-row">
            <div class="ui-grid-col-4"><label>Enabled*</label></div>
            <div class="ui-grid-col-8" style="padding-top: 6px;">
              <p-inputSwitch [(ngModel)]="currentUser.enabled" name="enabled" onLabel="Yes" offLabel="No"></p-inputSwitch>
            </div>
          </div>
          <div class="ui-grid-row">
            <div class="ui-grid-col-12">
              <div *ngIf="userErrors" class="alert alert-danger" role="alert">{{ userErrors }}<br>{{ userErrors?._body }}</div>
            </div>
          </div>
        </div>
        <footer>
          <div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
            <div *ngIf="isLoading" class="fa-spinner--wrapper" style="top: 14px;left: -5px;"><i class="fa fa-spinner fa-spin"></i></div>
            <template [ngIf]="!isNewUser">
              <button (click)="saveUser()" [disabled]="isLoading" label="Apply" type="button" pButton icon="fa-check"></button>
            </template>
            <template [ngIf]="isNewUser">
              <button (click)="saveUser()" [disabled]="isLoading" label="Add user" type="button" pButton icon="fa-plus"></button>
            </template>
          </div>
        </footer>
      </form>
    </p-dialog>
  </div>
</div>